# 반복 이벤트 기능 테스트 체크리스트 ✅

## 📋 목적
반복 이벤트의 **완료**, **수정**, **삭제** 기능이 RFC 5545 표준에 맞게 정확히 동작하는지 확인

---

## 🎯 테스트 환경 준비

### 1. 데이터베이스 초기화
- [ ] 앱 재시작 또는 DB 초기화
- [ ] Schema version이 10인지 확인
- [ ] `ScheduleCompletion`, `TaskCompletion` 테이블 생성 확인

### 2. 테스트용 반복 이벤트 생성
#### Schedule (일정)
- [ ] **매일 반복** 일정 1개 생성 (예: "매일 운동", 2주간)
- [ ] **매주 월/수/금 반복** 일정 1개 생성 (예: "헬스장", 1개월간)
- [ ] **매월 15일 반복** 일정 1개 생성 (예: "월급날", 3개월간)

#### Task (할일)
- [ ] **매일 반복** 할일 1개 생성 (예: "물 2L 마시기", 2주간)
- [ ] **매주 토/일 반복** 할일 1개 생성 (예: "집안일", 1개월간)
- [ ] **매월 1일 반복** 할일 1개 생성 (예: "카드값 결제", 3개월간)

---

## ✅ Part 1: 완료(Completion) 기능 테스트

### A. Schedule 완료 테스트

#### Test 1.1: 단일 날짜 완료 (매일 반복)
**준비:**
- [ ] "매일 운동" 일정 확인 (예: 10/30 ~ 11/13, 15일간)

**실행:**
1. [ ] 10/30(오늘) → Date Detail View에서 "매일 운동" 완료 체크
2. [ ] 10/31(내일) → Date Detail View로 이동

**검증:**
- [ ] ✅ 10/30은 캘린더에서 **보이지 않음** (완료됨)
- [ ] ✅ 10/31은 캘린더에서 **보임** (완료 안됨)
- [ ] ✅ 11/1도 **보임** (다른 날짜 영향 없음)
- [ ] ✅ 완료된 항목 섹션에 10/30 "매일 운동"이 **보임**

**DB 확인:**
```sql
SELECT * FROM schedule_completion WHERE schedule_id = [ID];
-- completed_date = 2025-10-30만 있어야 함
```
- [ ] ✅ 해당 날짜 1개만 completion 레코드 존재

#### Test 1.2: 여러 날짜 완료
**실행:**
1. [ ] 10/31(내일) → "매일 운동" 완료 체크
2. [ ] 11/1(모레) → "매일 운동" 완료 체크

**검증:**
- [ ] ✅ 10/30, 10/31, 11/1은 **안 보임**
- [ ] ✅ 11/2, 11/3은 **보임**
- [ ] ✅ 완료된 항목에 3개 날짜 모두 표시

**DB 확인:**
- [ ] ✅ schedule_completion에 3개 레코드 (10/30, 10/31, 11/1)

#### Test 1.3: 완료 취소 (Undo)
**실행:**
1. [ ] 10/30 완료된 항목 섹션에서 "매일 운동" 다시 클릭 (완료 해제)

**검증:**
- [ ] ✅ 10/30 일정이 **다시 보임**
- [ ] ✅ 완료된 항목 섹션에서 **사라짐**

**DB 확인:**
- [ ] ✅ 10/30 completion 레코드 **삭제됨**
- [ ] ✅ 10/31, 11/1 completion은 **유지됨**

---

### B. Task 완료 테스트

#### Test 1.4: 단일 날짜 완료 (매주 토/일)
**준비:**
- [ ] "집안일" 할일 확인 (매주 토/일, 11/1, 11/2, 11/8, 11/9...)

**실행:**
1. [ ] 11/1(토) → Date Detail View에서 "집안일" 완료 체크

**검증:**
- [ ] ✅ 11/1은 **안 보임** (완료됨)
- [ ] ✅ 11/2(일)는 **보임** (다음 발생)
- [ ] ✅ 11/8, 11/9도 **보임** (미래 발생)
- [ ] ✅ 완료된 항목에 11/1 "집안일" 표시

#### Test 1.5: 실행일과 마감일이 있는 Task 완료
**준비:**
- [ ] Task에 실행일(executionDate)과 마감일(dueDate) 모두 설정된 반복 할일

**실행:**
1. [ ] 특정 실행일의 할일 완료

**검증:**
- [ ] ✅ 해당 실행일만 **안 보임**
- [ ] ✅ 다른 실행일은 **보임**

---

## 🔧 Part 2: 수정(Edit) 기능 테스트

### A. Schedule 수정 - "この回のみ(오늘만)"

#### Test 2.1: 제목만 변경
**준비:**
- [ ] "매주 월/수/금 헬스장" 일정 (10/30은 금요일)

**실행:**
1. [ ] 10/30(금) → 일정 Detail Modal 열기
2. [ ] 제목을 "헬스장" → "**헬스장 + PT**"로 변경
3. [ ] 저장 시 **"この回のみ変更"** 선택

**검증:**
- [ ] ✅ 10/30(금)만 "헬스장 + PT"로 표시
- [ ] ✅ 11/1(월), 11/3(수), 11/5(금)은 "헬스장" 유지
- [ ] ✅ 11/5(금)는 **"헬스장"** (원래 제목)

**DB 확인:**
```sql
SELECT * FROM recurring_exception 
WHERE recurring_pattern_id = [PATTERN_ID]
AND original_date = '2025-10-30';
-- modified_title = '헬스장 + PT'
-- is_cancelled = false
-- is_rescheduled = true (시간 변경 시)
```
- [ ] ✅ RecurringException 레코드 생성됨
- [ ] ✅ Base Schedule는 **변경 없음**

#### Test 2.2: 시간 변경
**실행:**
1. [ ] 10/30(금) → 시간을 14:00-15:00 → **16:00-17:00**으로 변경
2. [ ] **"この回のみ変更"** 선택

**검증:**
- [ ] ✅ 10/30만 16:00-17:00으로 표시
- [ ] ✅ 다른 날짜는 14:00-15:00 유지

**DB 확인:**
- [ ] ✅ new_start_date, new_end_date 업데이트됨
- [ ] ✅ is_rescheduled = true

#### Test 2.3: 색상 변경
**실행:**
1. [ ] 10/30(금) → 색상을 Blue → **Red**로 변경
2. [ ] **"この回のみ変更"** 선택

**검증:**
- [ ] ✅ 10/30만 Red 색상
- [ ] ✅ 다른 날짜는 Blue 유지

---

### B. Schedule 수정 - "この予定以降(이후)"

#### Test 2.4: 이후 모든 일정 제목 변경
**준비:**
- [ ] "매일 운동" 일정 (10/30 ~ 11/13)

**실행:**
1. [ ] 11/1(수)부터 → 제목을 "운동" → **"아침 운동"**으로 변경
2. [ ] **"この予定以降を変更"** 선택

**검증:**
- [ ] ✅ 10/30, 10/31은 **"운동"** (이전 제목 유지)
- [ ] ✅ 11/1부터 11/13까지는 **"아침 운동"** (새 제목)
- [ ] ✅ 캘린더에서 두 개의 다른 이벤트로 표시

**DB 확인:**
```sql
-- 기존 Schedule
SELECT * FROM recurring_pattern WHERE entity_id = [OLD_ID];
-- until = 2025-10-31 23:59:59 (어제까지만)

-- 새 Schedule
SELECT * FROM schedule WHERE id = [NEW_ID];
-- summary = '아침 운동'
-- start >= 2025-11-01

SELECT * FROM recurring_pattern WHERE entity_id = [NEW_ID];
-- dtstart = 2025-11-01
```
- [ ] ✅ 기존 패턴의 UNTIL이 10/31로 설정됨
- [ ] ✅ 새 Schedule과 RecurringPattern 생성됨

#### Test 2.5: 이후 반복 규칙 변경
**실행:**
1. [ ] 11/1부터 → 반복을 "매일" → **"매주 월/수/금"**으로 변경
2. [ ] **"この予定以降を変更"** 선택

**검증:**
- [ ] ✅ 10/30, 10/31은 **매일** 표시 (기존)
- [ ] ✅ 11/1부터는 **월/수/금만** 표시 (새 규칙)
- [ ] ✅ 11/2(화)는 **안 보임**

**DB 확인:**
- [ ] ✅ 새 RecurringPattern의 rrule이 FREQ=WEEKLY;BYDAY=MO,WE,FR

---

### C. Schedule 수정 - "すべての回(전체)"

#### Test 2.6: 전체 일정 제목 변경
**준비:**
- [ ] "매월 15일 월급날" 일정

**실행:**
1. [ ] 아무 날짜에서 → 제목을 "월급날" → **"월급 입금일"**로 변경
2. [ ] **"すべての回を変更"** 선택

**검증:**
- [ ] ✅ **모든 날짜**가 "월급 입금일"로 표시
- [ ] ✅ 과거 날짜도 제목 변경됨
- [ ] ✅ 미래 날짜도 제목 변경됨

**DB 확인:**
- [ ] ✅ Base Schedule의 summary 업데이트됨
- [ ] ✅ RecurringPattern은 **변경 없음** (RRULE 유지)
- [ ] ✅ RecurringException **없음**

---

### D. Task 수정 테스트 (동일한 패턴)

#### Test 2.7: Task "この回のみ" 수정
- [ ] Task 제목 변경 → 해당 날짜만 변경 확인
- [ ] Task 마감일 변경 → 해당 날짜만 변경 확인

#### Test 2.8: Task "この予定以降" 수정
- [ ] Task 반복 규칙 변경 → RRULE 분할 확인
- [ ] 기존/새 Task가 올바르게 분리됨

#### Test 2.9: Task "すべての回" 수정
- [ ] 전체 Task 제목 변경 → 모든 발생 변경 확인

---

## 🗑️ Part 3: 삭제(Delete) 기능 테스트

### A. Schedule 삭제 - "この回のみ(오늘만)"

#### Test 3.1: 특정 날짜만 삭제
**준비:**
- [ ] "매일 운동" 일정 (10/30 ~ 11/13)

**실행:**
1. [ ] 11/1(수) → Detail Modal에서 **삭제** 버튼
2. [ ] **"この回のみ削除"** 선택

**검증:**
- [ ] ✅ 11/1은 **안 보임** (삭제됨)
- [ ] ✅ 10/31은 **보임** (이전 발생)
- [ ] ✅ 11/2는 **보임** (다음 발생)
- [ ] ✅ 11/3, 11/4... 모두 **보임** (미래 발생)

**DB 확인:**
```sql
SELECT * FROM recurring_exception 
WHERE original_date = '2025-11-01';
-- is_cancelled = true
-- is_rescheduled = false
```
- [ ] ✅ RecurringException에 is_cancelled=true 레코드 생성
- [ ] ✅ Base Schedule는 **삭제 안됨**

#### Test 3.2: 여러 날짜 각각 삭제
**실행:**
1. [ ] 11/2 삭제 (この回のみ)
2. [ ] 11/3 삭제 (この回のみ)

**검증:**
- [ ] ✅ 11/1, 11/2, 11/3 모두 **안 보임**
- [ ] ✅ 11/4부터는 **보임**

**DB 확인:**
- [ ] ✅ RecurringException에 3개 레코드 (11/1, 11/2, 11/3)
- [ ] ✅ 모두 is_cancelled=true

---

### B. Schedule 삭제 - "この予定以降(이후)"

#### Test 3.3: 특정 날짜 이후 모두 삭제
**준비:**
- [ ] "매일 운동" 일정 (10/30 ~ 11/13)

**실행:**
1. [ ] 11/5(금) → Detail Modal에서 **삭제**
2. [ ] **"この予定以降を削除"** 선택

**검증:**
- [ ] ✅ 10/30 ~ 11/4까지는 **보임** (유지)
- [ ] ✅ 11/5부터는 **안 보임** (삭제됨)
- [ ] ✅ 11/6, 11/7... 11/13 모두 **안 보임**

**DB 확인:**
```sql
SELECT * FROM recurring_pattern WHERE entity_id = [ID];
-- until = 2025-11-04 23:59:59 (11/5 전날까지)
```
- [ ] ✅ RecurringPattern의 UNTIL이 11/4로 설정됨
- [ ] ✅ Base Schedule는 **삭제 안됨**

---

### C. Schedule 삭제 - "すべての回(전체)"

#### Test 3.4: 전체 일정 삭제
**준비:**
- [ ] "매월 15일 월급날" 일정

**실행:**
1. [ ] 아무 날짜에서 → Detail Modal에서 **삭제**
2. [ ] **"すべての回を削除"** 선택

**검증:**
- [ ] ✅ **모든 날짜**에서 안 보임
- [ ] ✅ 과거 발생도 삭제됨
- [ ] ✅ 미래 발생도 삭제됨
- [ ] ✅ 캘린더에서 완전히 사라짐

**DB 확인:**
```sql
SELECT * FROM schedule WHERE id = [ID];
-- 레코드 없음 (삭제됨)

SELECT * FROM recurring_pattern WHERE entity_id = [ID];
-- 레코드 없음 (CASCADE 삭제)
```
- [ ] ✅ Schedule 레코드 **삭제됨**
- [ ] ✅ RecurringPattern도 **삭제됨** (CASCADE)
- [ ] ✅ 모든 RecurringException도 **삭제됨** (CASCADE)

---

### D. Task 삭제 테스트 (동일한 패턴)

#### Test 3.5: Task "この回のみ" 삭제
- [ ] 특정 실행일만 삭제 → 해당 날짜만 안 보임
- [ ] 다른 실행일은 유지됨

#### Test 3.6: Task "この予定以降" 삭제
- [ ] 특정 날짜 이후 삭제 → UNTIL 설정 확인
- [ ] 이전 발생은 유지됨

#### Test 3.7: Task "すべての回" 삭제
- [ ] 전체 Task 삭제 → 모든 발생 삭제 확인

---

## 🔄 Part 4: 복합 시나리오 테스트

### Test 4.1: 완료 + 수정 조합
**시나리오:**
1. [ ] 10/30 "매일 운동" 완료 체크
2. [ ] 11/1부터 제목을 "아침 운동"으로 변경 (この予定以降)

**검증:**
- [ ] ✅ 10/30은 완료됨 (안 보임)
- [ ] ✅ 10/31은 "운동"으로 보임
- [ ] ✅ 11/1부터는 "아침 운동"으로 보임

### Test 4.2: 수정 + 삭제 조합
**시나리오:**
1. [ ] 11/1 "매일 운동" 제목 변경 (この回のみ)
2. [ ] 11/2 삭제 (この回のみ)

**검증:**
- [ ] ✅ 11/1은 수정된 제목으로 보임
- [ ] ✅ 11/2는 안 보임 (삭제됨)
- [ ] ✅ 11/3은 원래 제목으로 보임

### Test 4.3: 삭제 + 완료 조합
**시나리오:**
1. [ ] 11/1 삭제 (この回のみ)
2. [ ] 11/2 완료 체크

**검증:**
- [ ] ✅ 11/1, 11/2 모두 안 보임
- [ ] ✅ 완료된 항목에는 11/2만 표시 (11/1은 삭제되어 완료 섹션에 없음)

### Test 4.4: 이후 수정 + 오늘만 수정 조합
**시나리오:**
1. [ ] 11/1부터 제목 변경 (この予定以降) → "아침 운동"
2. [ ] 11/5 제목 변경 (この回のみ) → "아침 PT"

**검증:**
- [ ] ✅ 10/30, 10/31: "운동"
- [ ] ✅ 11/1~11/4: "아침 운동"
- [ ] ✅ 11/5: "아침 PT"
- [ ] ✅ 11/6 이후: "아침 운동"

---

## 🐛 Part 5: 엣지 케이스 테스트

### Test 5.1: 반복 없는 일정/할일
- [ ] 반복 없는 Schedule 완료 → 정상 완료됨
- [ ] 반복 없는 Task 완료 → 정상 완료됨
- [ ] 수정 시 "この回のみ" 모달 **안 뜸** (일반 저장)
- [ ] 삭제 시 "この回のみ" 모달 **안 뜸** (일반 삭제)

### Test 5.2: UNTIL이 있는 반복 일정
**준비:**
- [ ] 10/30 ~ 11/10까지만 반복하는 일정 생성 (UNTIL 설정)

**실행:**
1. [ ] 11/5부터 삭제 (この予定以降)

**검증:**
- [ ] ✅ 10/30 ~ 11/4까지만 보임
- [ ] ✅ 11/5 ~ 11/10은 안 보임

### Test 5.3: Exception이 이미 있는 날짜
**준비:**
1. [ ] 11/1을 "この回のみ" 수정 (제목 변경)

**실행:**
1. [ ] 11/1을 **다시** "この回のみ" 수정 (색상 변경)

**검증:**
- [ ] ✅ 제목과 색상 **모두** 변경됨
- [ ] ✅ RecurringException이 **업데이트**됨 (중복 생성 안됨)

### Test 5.4: 과거 날짜 수정/삭제
- [ ] 과거 날짜의 반복 일정 수정 → 정상 작동
- [ ] 과거 날짜의 반복 일정 삭제 → 정상 작동
- [ ] 과거 날짜 완료 → 정상 완료됨

### Test 5.5: 반복 규칙이 복잡한 경우
**준비:**
- [ ] 매주 월/화/수/목/금 반복 (주중만)

**실행:**
1. [ ] 특정 수요일만 삭제 (この回のみ)

**검증:**
- [ ] ✅ 해당 수요일만 안 보임
- [ ] ✅ 다른 수요일은 보임
- [ ] ✅ 월/화/목/금은 그대로

---

## 📱 Part 6: UI/UX 테스트

### Test 6.1: 모달 흐름
- [ ] 수정 시 "この回のみ/この予定以降/すべての回" 모달 표시됨
- [ ] 삭제 시 "この回のみ/この予定以降/すべての回" 모달 표시됨
- [ ] 각 선택 시 적절한 Toast 메시지 표시됨
- [ ] 모달 닫기 후 Date Detail View로 돌아감

### Test 6.2: 완료 상태 표시
- [ ] 완료된 일정/할일은 Date Detail View에서 안 보임
- [ ] "完了したタスク" 섹션에 표시됨
- [ ] 완료 해제 시 다시 원래 섹션으로 이동

### Test 6.3: 캘린더 표시
- [ ] 반복 일정이 캘린더에 올바르게 표시됨
- [ ] 완료된 날짜는 캘린더에서 안 보임
- [ ] Exception이 있는 날짜는 수정된 내용으로 표시됨

---

## 🗄️ Part 7: 데이터 무결성 테스트

### Test 7.1: 외래 키 제약 (CASCADE)
**실행:**
1. [ ] Schedule 삭제 (すべての回)

**검증:**
```sql
-- RecurringPattern 자동 삭제 확인
SELECT * FROM recurring_pattern WHERE entity_id = [DELETED_ID];
-- 레코드 없음

-- RecurringException 자동 삭제 확인
SELECT * FROM recurring_exception WHERE recurring_pattern_id = [PATTERN_ID];
-- 레코드 없음

-- ScheduleCompletion 자동 삭제 확인
SELECT * FROM schedule_completion WHERE schedule_id = [DELETED_ID];
-- 레코드 없음
```
- [ ] ✅ 모든 관련 테이블 데이터 삭제됨

### Test 7.2: UNIQUE 제약
**실행:**
1. [ ] 같은 날짜에 같은 일정 두 번 완료 시도

**검증:**
- [ ] ✅ 중복 completion 레코드 생성 **안됨**
- [ ] ✅ 에러 없이 정상 동작

### Test 7.3: 데이터 일관성
- [ ] RecurringPattern 없는 Schedule에 Exception 생성 불가
- [ ] 완료된 날짜도 수정/삭제 가능
- [ ] UNTIL 이후 날짜는 표시 안됨

---

## 🔍 Part 8: 성능 테스트

### Test 8.1: 대량 데이터
**준비:**
- [ ] 1년간 매일 반복하는 일정 생성 (365개 발생)

**실행:**
1. [ ] Date Detail View 열기 (로딩 시간 체크)
2. [ ] 50개 날짜 완료 처리
3. [ ] 스크롤 성능 확인

**검증:**
- [ ] ✅ 로딩 시간 < 2초
- [ ] ✅ 스크롤 버벅임 없음
- [ ] ✅ 완료 처리 즉시 반영

### Test 8.2: 복잡한 Exception
**준비:**
- [ ] 30일 매일 반복 일정에서 15개를 "この回のみ" 수정

**실행:**
1. [ ] Date Detail View 열기
2. [ ] 캘린더 월 전환

**검증:**
- [ ] ✅ 수정된 15개가 올바르게 표시됨
- [ ] ✅ 성능 저하 없음

---

## ✅ 최종 체크리스트

### 기능 완성도
- [ ] 모든 완료 테스트 통과 (Part 1)
- [ ] 모든 수정 테스트 통과 (Part 2)
- [ ] 모든 삭제 테스트 통과 (Part 3)
- [ ] 복합 시나리오 통과 (Part 4)
- [ ] 엣지 케이스 처리 (Part 5)

### 사용자 경험
- [ ] UI/UX가 직관적임 (Part 6)
- [ ] 에러 메시지가 명확함
- [ ] Toast 메시지가 적절함

### 데이터 안정성
- [ ] 데이터 무결성 유지 (Part 7)
- [ ] CASCADE 삭제 정상 동작
- [ ] 제약 조건 동작

### 성능
- [ ] 대량 데이터 처리 원활 (Part 8)
- [ ] UI 응답 속도 빠름

---

## 🐛 발견된 버그 기록

### 버그 #1
**날짜:** ___________  
**현상:** ___________  
**재현 방법:** ___________  
**우선순위:** [ ] Critical [ ] High [ ] Medium [ ] Low

### 버그 #2
**날짜:** ___________  
**현상:** ___________  
**재현 방법:** ___________  
**우선순위:** [ ] Critical [ ] High [ ] Medium [ ] Low

---

## 📊 테스트 결과 요약

**테스트 일시:** ___________  
**테스터:** ___________

| 카테고리 | 통과 | 실패 | 비율 |
|---------|------|------|------|
| Part 1: 완료 | __ / __ | __ | __% |
| Part 2: 수정 | __ / __ | __ | __% |
| Part 3: 삭제 | __ / __ | __ | __% |
| Part 4: 복합 | __ / __ | __ | __% |
| Part 5: 엣지 | __ / __ | __ | __% |
| Part 6: UI/UX | __ / __ | __ | __% |
| Part 7: 무결성 | __ / __ | __ | __% |
| Part 8: 성능 | __ / __ | __ | __% |
| **전체** | **__ / __** | **__** | **__%** |

---

## 🎯 다음 단계

- [ ] 모든 Critical 버그 수정
- [ ] High 우선순위 버그 수정
- [ ] UI/UX 개선 사항 반영
- [ ] 최종 회귀 테스트
- [ ] 프로덕션 배포 준비

---

**✅ 100% 통과 시 배포 가능!** 🚀
