# ğŸ¯ ë””í…Œì¼ë·° ì ì„  ê²½ê³„ ë° ë¡œë”© ìµœì í™” ì™„ë£Œ

## ğŸ“‹ ìˆ˜ì • ë‚´ìš©

### 1. âœ… ì ì„  ê²½ê³„ ê·œì¹™ ëª…í™•í™”

**ë¬¸ì œì :**
- ì¼ì •ì€ ì ì„  ì•„ë˜ë¡œ ì´ë™í•  ìˆ˜ ì—†ì—ˆì§€ë§Œ, í• ì¼ê³¼ ìŠµê´€ì€ ì ì„  ìœ„ë¡œ ì´ë™ì´ ê°€ëŠ¥í–ˆìŒ
- ì ì„ ì€ "ì¼ì • ì„¹ì…˜"ê³¼ "í• ì¼/ìŠµê´€ ì„¹ì…˜"ì„ êµ¬ë¶„í•˜ëŠ” ê²½ê³„ì„ ì¸ë°, ê²½ê³„ ê·œì¹™ì´ ì¼ê´€ì„±ì´ ì—†ì—ˆìŒ

**í•´ê²°:**
```dart
// âœ… ê²½ê³„ ì œì•½ ê·œì¹™ (ì–‘ë°©í–¥):
// 1. ì¼ì •(Schedule)ì€ ì ì„  ì•„ë˜ë¡œ ì´ë™ ë¶ˆê°€
// 2. í• ì¼(Task), ìŠµê´€(Habit)ì€ ì ì„  ìœ„ë¡œ ì´ë™ ë¶ˆê°€
bool shouldBlock = false;
String blockReason = '';

if (item.type == UnifiedItemType.schedule) {
  // ì¼ì •ì„ ì ì„  ì•„ë˜ë¡œ ì´ë™í•˜ë ¤ëŠ” ê²½ìš°
  if (targetIndex > dividerIndex) {
    shouldBlock = true;
    blockReason = 'ì¼ì •ì„ ì ì„  ì•„ë˜ë¡œ ì´ë™ ë¶ˆê°€';
  }
} else if (item.type == UnifiedItemType.task ||
    item.type == UnifiedItemType.habit) {
  // í• ì¼/ìŠµê´€ì„ ì ì„  ìœ„ë¡œ ì´ë™í•˜ë ¤ëŠ” ê²½ìš°
  if (targetIndex < dividerIndex) {
    shouldBlock = true;
    blockReason = '${item.type == UnifiedItemType.task ? 'í• ì¼' : 'ìŠµê´€'}ì„ ì ì„  ìœ„ë¡œ ì´ë™ ë¶ˆê°€';
  }
}
```

**íš¨ê³¼:**
- âœ… ì¼ì •: ì ì„  ì•„ë˜ë¡œ ì´ë™ ì‹œë„ ì‹œ ì°¨ë‹¨ (ê¸°ì¡´ê³¼ ë™ì¼)
- âœ… í• ì¼: ì ì„  ìœ„ë¡œ ì´ë™ ì‹œë„ ì‹œ ì°¨ë‹¨ (ìƒˆë¡œ ì¶”ê°€)
- âœ… ìŠµê´€: ì ì„  ìœ„ë¡œ ì´ë™ ì‹œë„ ì‹œ ì°¨ë‹¨ (ìƒˆë¡œ ì¶”ê°€)
- âœ… ì°¨ë‹¨ ì‹œ Heavy Haptic + ì›ë˜ ìœ„ì¹˜ë¡œ ë³µê·€ ì• ë‹ˆë©”ì´ì…˜

---

### 2. â±ï¸ DB ì €ì¥ ë””ë°”ìš´ìŠ¤ë¡œ ì—°ì† ë¡œë”© ë°©ì§€

**ë¬¸ì œì :**
- ë“œë˜ê·¸ì•¤ë“œë¡­ìœ¼ë¡œ ìˆœì„œ ë³€ê²½ ì‹œë§ˆë‹¤ ì¦‰ì‹œ DB ì €ì¥
- DB ì €ì¥ â†’ StreamBuilder íŠ¸ë¦¬ê±° â†’ FutureBuilder rebuild â†’ í™”ë©´ ê¹œë¹¡ì„
- íŠ¹íˆ ì—¬ëŸ¬ ë²ˆ ì—°ì†ìœ¼ë¡œ ë“œë˜ê·¸í•  ë•Œ í™”ë©´ì´ ê³„ì† ë¡œë”©ë˜ëŠ” í˜„ìƒ

**í•´ê²°:**
```dart
// â±ï¸ DB ì €ì¥ ë””ë°”ìš´ìŠ¤ë¥¼ ìœ„í•œ íƒ€ì´ë¨¸ ì¶”ê°€
Timer? _saveOrderDebounceTimer;

// _handleReorder ë‚´ë¶€:
// â±ï¸ ë””ë°”ìš´ìŠ¤ë¥¼ ì‚¬ìš©í•´ DB ì €ì¥ (300ms í›„ ì €ì¥)
// ì´ê±°ë¥¼ í•´ì„œ â†’ ì—¬ëŸ¬ ë²ˆ ë“œë˜ê·¸í•  ë•Œ DB ì €ì¥ì„ ëª¨ì•„ì„œ í•œ ë²ˆë§Œ ì‹¤í–‰
_saveOrderDebounceTimer?.cancel();
_saveOrderDebounceTimer = Timer(const Duration(milliseconds: 300), () {
  _saveDailyCardOrder(items);
});
```

**ìµœì í™” ë‚´ìš©:**
1. **ë””ë°”ìš´ìŠ¤ íƒ€ì´ë¨¸**: ë“œë˜ê·¸ ì¢…ë£Œ í›„ 300ms ëŒ€ê¸° â†’ ë§ˆì§€ë§‰ ë³€ê²½ì‚¬í•­ë§Œ DB ì €ì¥
2. **setState ì œê±°**: AnimatedReorderableListViewê°€ ìì²´ì ìœ¼ë¡œ UI ì—…ë°ì´íŠ¸í•˜ë¯€ë¡œ ë¶ˆí•„ìš”í•œ setState ì œê±°
3. **íƒ€ì´ë¨¸ ì •ë¦¬**: dispose()ì—ì„œ íƒ€ì´ë¨¸ ì·¨ì†Œí•˜ì—¬ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€

**íš¨ê³¼:**
- âœ… ì—¬ëŸ¬ ë²ˆ ë“œë˜ê·¸í•´ë„ DB ì €ì¥ì€ 1ë²ˆë§Œ ì‹¤í–‰
- âœ… StreamBuilder íŠ¸ë¦¬ê±° íšŸìˆ˜ ê°ì†Œ â†’ í™”ë©´ ê¹œë¹¡ì„ ì—†ìŒ
- âœ… ë¶€ë“œëŸ¬ìš´ ë“œë˜ê·¸ì•¤ë“œë¡­ ê²½í—˜

---

## ğŸ¨ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

### Before (ìˆ˜ì • ì „):
- âŒ í• ì¼/ìŠµê´€ì„ ì ì„  ìœ„ë¡œ ë“œë˜ê·¸í•˜ë©´ ì¼ì • ì„¹ì…˜ì— ë“¤ì–´ê°
- âŒ ë“œë˜ê·¸í•  ë•Œë§ˆë‹¤ í™”ë©´ì´ ê¹œë¹¡ì´ë©° ë¡œë”©ë¨
- âŒ ì—°ì†ìœ¼ë¡œ ë“œë˜ê·¸í•˜ë©´ ê³„ì† ë¡œë”© ì¸ë””ì¼€ì´í„° í‘œì‹œ

### After (ìˆ˜ì • í›„):
- âœ… í• ì¼/ìŠµê´€ì„ ì ì„  ìœ„ë¡œ ë“œë˜ê·¸í•˜ë©´ Heavy Haptic + ì›ë˜ ìœ„ì¹˜ë¡œ ë³µê·€
- âœ… ë“œë˜ê·¸ ì¤‘ì—ëŠ” í™”ë©´ì´ ê¹œë¹¡ì´ì§€ ì•ŠìŒ
- âœ… ë“œë˜ê·¸ ì¢…ë£Œ í›„ 300ms í›„ DB ì €ì¥ (ì‚¬ìš©ìëŠ” ì €ì¥ ê³¼ì •ì„ ëŠë¼ì§€ ëª»í•¨)
- âœ… ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ê²½í—˜

---

## ğŸ“Š ê¸°ìˆ  ì„¸ë¶€ì‚¬í•­

### íŒŒì¼ ìˆ˜ì •:
- `lib/screen/date_detail_view.dart`

### ì¶”ê°€ëœ ë‚´ìš©:
1. `dart:async` ì„í¬íŠ¸ (Timer ì‚¬ìš©)
2. `Timer? _saveOrderDebounceTimer` í•„ë“œ
3. `dispose()` ë‚´ íƒ€ì´ë¨¸ ì·¨ì†Œ ë¡œì§
4. `onReorder()` ë‚´ ì–‘ë°©í–¥ ê²½ê³„ ì²´í¬ ë¡œì§
5. `_handleReorder()` ë‚´ ë””ë°”ìš´ìŠ¤ ë¡œì§

### ì½”ë“œ ë©”íŠ¸ë¦­ìŠ¤:
- ì¶”ê°€ëœ ì¤„: ~40ì¤„
- ì‚­ì œëœ ì¤„: ~10ì¤„ (ë¶ˆí•„ìš”í•œ setState ì œê±°)
- ìˆ˜ì •ëœ í•¨ìˆ˜: 3ê°œ (`onReorder`, `_handleReorder`, `dispose`)

---

## âœ… í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì¼ì • â†’ ì ì„  ì•„ë˜ ì´ë™
1. ì¼ì • ì¹´ë“œë¥¼ ê¸¸ê²Œ ëˆ„ë¥´ê¸°
2. ì ì„  ì•„ë˜ í• ì¼/ìŠµê´€ ì˜ì—­ìœ¼ë¡œ ë“œë˜ê·¸
3. **ì˜ˆìƒ ê²°ê³¼**: Heavy Haptic + ì›ë˜ ìœ„ì¹˜ë¡œ ë³µê·€ âœ…

### ì‹œë‚˜ë¦¬ì˜¤ 2: í• ì¼ â†’ ì ì„  ìœ„ ì´ë™
1. í• ì¼ ì¹´ë“œë¥¼ ê¸¸ê²Œ ëˆ„ë¥´ê¸°
2. ì ì„  ìœ„ ì¼ì • ì˜ì—­ìœ¼ë¡œ ë“œë˜ê·¸
3. **ì˜ˆìƒ ê²°ê³¼**: Heavy Haptic + ì›ë˜ ìœ„ì¹˜ë¡œ ë³µê·€ âœ…

### ì‹œë‚˜ë¦¬ì˜¤ 3: ìŠµê´€ â†’ ì ì„  ìœ„ ì´ë™
1. ìŠµê´€ ì¹´ë“œë¥¼ ê¸¸ê²Œ ëˆ„ë¥´ê¸°
2. ì ì„  ìœ„ ì¼ì • ì˜ì—­ìœ¼ë¡œ ë“œë˜ê·¸
3. **ì˜ˆìƒ ê²°ê³¼**: Heavy Haptic + ì›ë˜ ìœ„ì¹˜ë¡œ ë³µê·€ âœ…

### ì‹œë‚˜ë¦¬ì˜¤ 4: ì—°ì† ë“œë˜ê·¸
1. í• ì¼ ì¹´ë“œ ì—¬ëŸ¬ ê°œë¥¼ ì—°ì†ìœ¼ë¡œ ë“œë˜ê·¸
2. ìˆœì„œë¥¼ ì—¬ëŸ¬ ë²ˆ ë³€ê²½
3. **ì˜ˆìƒ ê²°ê³¼**: 
   - í™”ë©´ ê¹œë¹¡ì„ ì—†ìŒ âœ…
   - ë§ˆì§€ë§‰ ë³€ê²½ í›„ 300ms í›„ DB ì €ì¥ âœ…
   - ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ âœ…

---

## ğŸ” ë””ë²„ê·¸ ë¡œê·¸

```
ğŸ¯ [onReorder] ì´ë™: index 1 â†’ 3 (divider: 2, type: task)
ğŸš« [onReorder] í• ì¼ì„ ì ì„  ìœ„ë¡œ ì´ë™ ë¶ˆê°€! oldIndex=1, newIndex=4, targetIndex=3, dividerIndex=2
```

---

## ğŸ¯ í–¥í›„ ê°œì„  ì‚¬í•­

1. **ì ì„  ìœ„ì¹˜ ìë™ ì¡°ì •**: 
   - í˜„ì¬ëŠ” ë§ˆì§€ë§‰ ì¼ì • ë‹¤ìŒì— ì ì„  ê³ ì •
   - í–¥í›„ ì¼ì •ì´ 0ê°œì¼ ë•Œ ì ì„  ìˆ¨ê¹€ ì²˜ë¦¬ ê°€ëŠ¥

2. **ë“œë˜ê·¸ ë¹„ì£¼ì–¼ í”¼ë“œë°±**:
   - ì ì„  ê·¼ì²˜ì—ì„œ ë“œë˜ê·¸ ì‹œ ì ì„  í•˜ì´ë¼ì´íŠ¸
   - ì´ë™ ë¶ˆê°€ ì˜ì—­ì— ì§„ì… ì‹œ ì¹´ë“œì— ë¹¨ê°„ìƒ‰ í…Œë‘ë¦¬

3. **Undo ê¸°ëŠ¥**:
   - ìˆœì„œ ë³€ê²½ í›„ ì·¨ì†Œ ê¸°ëŠ¥ ì¶”ê°€
   - Snackbarì— "ì‹¤í–‰ ì·¨ì†Œ" ë²„íŠ¼ í‘œì‹œ

---

## ğŸ“ ì°¸ê³  ì‚¬í•­

- **AnimatedReorderableListView**: ìì²´ì ìœ¼ë¡œ UI ì—…ë°ì´íŠ¸ë¥¼ ì²˜ë¦¬í•˜ë¯€ë¡œ setState ë¶ˆí•„ìš”
- **StreamBuilder ìµœì í™”**: ë””ë°”ìš´ìŠ¤ë¥¼ í†µí•´ DB ì—…ë°ì´íŠ¸ íšŸìˆ˜ ìµœì†Œí™”
- **Future ìºì‹œ**: ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìˆì–´ rebuild ì‹œ ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€ë¨

---

**ì‘ì„±ì¼**: 2025-10-25  
**ì‘ì„±ì**: AI Assistant  
**ìƒíƒœ**: âœ… ì™„ë£Œ ë° í…ŒìŠ¤íŠ¸ í•„ìš”
