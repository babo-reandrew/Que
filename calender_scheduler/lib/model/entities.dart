import 'package:drift/drift.dart';

/// Task (í• ì¼) í…Œì´ë¸”
/// ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ í• ì¼ ë°ì´í„°ë¥¼ ì €ìž¥í•˜ëŠ” í…Œì´ë¸”ì„ ì •ì˜í•´ì„œ
/// ì´ê±°ë¥¼ í•´ì„œ â†’ ì œëª©, ì™„ë£Œ ì—¬ë¶€, ë§ˆê°ì¼, ìƒ‰ìƒ ë“±ì„ ê´€ë¦¬í•˜ê³ 
/// ì´ê±°ëŠ” ì´ëž˜ì„œ â†’ Quick Add ì‹œìŠ¤í…œì—ì„œ í• ì¼ì„ ì¶”ê°€/ê´€ë¦¬í•  ìˆ˜ ìžˆë‹¤
@DataClassName('TaskData')
class Task extends Table {
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìžë™ ì¦ê°€í•˜ëŠ” idë¥¼ primary keyë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ê° í• ì¼ì„ ê³ ìœ í•˜ê²Œ ì‹ë³„í•œë‹¤
  IntColumn get id => integer().autoIncrement()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì œëª©ì„ í•„ìˆ˜ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ í• ì¼ì˜ ë‚´ìš©ì„ ì €ìž¥í•œë‹¤
  TextColumn get title => text()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì™„ë£Œ ì—¬ë¶€ë¥¼ booleanìœ¼ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì²´í¬ë°•ìŠ¤ ìƒíƒœë¥¼ ê´€ë¦¬í•œë‹¤
  // ì´ê±°ëŠ” ì´ëž˜ì„œ â†’ ê¸°ë³¸ê°’ì€ false (ë¯¸ì™„ë£Œ)
  BoolColumn get completed => boolean().withDefault(const Constant(false))();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë§ˆê°ì¼ì„ nullable DateTimeìœ¼ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ë§ˆê°ì¼ì´ ì—†ëŠ” í• ì¼ë„ í—ˆìš©í•œë‹¤
  DateTimeColumn get dueDate => dateTime().nullable()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ëª©ë¡ IDë¥¼ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì—¬ëŸ¬ ëª©ë¡(Inbox, í”„ë¡œì íŠ¸ ë“±)ìœ¼ë¡œ ë¶„ë¥˜í•œë‹¤
  // ì´ê±°ëŠ” ì´ëž˜ì„œ â†’ ê¸°ë³¸ê°’ì€ 'inbox'
  TextColumn get listId => text().withDefault(const Constant('inbox'))();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìƒì„±ì¼ì„ DateTimeìœ¼ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì–¸ì œ ë§Œë“¤ì–´ì¡ŒëŠ”ì§€ ê¸°ë¡í•œë‹¤
  DateTimeColumn get createdAt => dateTime()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì™„ë£Œì¼ì„ nullable DateTimeìœ¼ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì™„ë£Œëœ ë‚ ì§œë¥¼ ê¸°ë¡í•œë‹¤
  DateTimeColumn get completedAt => dateTime().nullable()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìƒ‰ìƒ IDë¥¼ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ìƒ‰ìƒì„ êµ¬ë¶„í•œë‹¤
  // ì´ê±°ëŠ” ì´ëž˜ì„œ â†’ ê¸°ë³¸ê°’ì€ 'gray'
  TextColumn get colorId => text().withDefault(const Constant('gray'))();

  // âœ… ë°˜ë³µ ê·œì¹™ ì¶”ê°€ (JSON í˜•ì‹)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë°˜ë³µ ì£¼ê¸°ë¥¼ JSON í˜•ì‹ì˜ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ë§¤ì¼/ë§¤ì›”/ê°„ê²© ë°˜ë³µ ì„¤ì •ì„ ì €ìž¥í•œë‹¤
  TextColumn get repeatRule => text().withDefault(const Constant(''))();

  // âœ… ë¦¬ë§ˆì¸ë” ì„¤ì • ì¶”ê°€ (JSON í˜•ì‹)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë¦¬ë§ˆì¸ë” ì„¤ì •ì„ JSON í˜•ì‹ì˜ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì•Œë¦¼ ì‹œê°„ì„ ì €ìž¥í•œë‹¤
  TextColumn get reminder => text().withDefault(const Constant(''))();
}

/// Habit (ìŠµê´€) í…Œì´ë¸”
/// ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìŠµê´€ ë°ì´í„°ë¥¼ ì €ìž¥í•˜ëŠ” í…Œì´ë¸”ì„ ì •ì˜í•´ì„œ
/// ì´ê±°ë¥¼ í•´ì„œ â†’ ë°˜ë³µë˜ëŠ” ë£¨í‹´ì„ ê´€ë¦¬í•˜ê³ 
/// ì´ê±°ëŠ” ì´ëž˜ì„œ â†’ ë‚ ì§œë³„ ì™„ë£Œ ê¸°ë¡ì„ ì¶”ì í•  ìˆ˜ ìžˆë‹¤
@DataClassName('HabitData')
class Habit extends Table {
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìžë™ ì¦ê°€í•˜ëŠ” idë¥¼ primary keyë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ê° ìŠµê´€ì„ ê³ ìœ í•˜ê²Œ ì‹ë³„í•œë‹¤
  IntColumn get id => integer().autoIncrement()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì œëª©ì„ í•„ìˆ˜ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ìŠµê´€ì˜ ë‚´ìš©ì„ ì €ìž¥í•œë‹¤
  TextColumn get title => text()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìƒì„±ì¼ì„ DateTimeìœ¼ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì–¸ì œ ì‹œìž‘í–ˆëŠ”ì§€ ê¸°ë¡í•œë‹¤
  DateTimeColumn get createdAt => dateTime()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìƒ‰ìƒ IDë¥¼ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ìƒ‰ìƒì„ êµ¬ë¶„í•œë‹¤
  // ì´ê±°ëŠ” ì´ëž˜ì„œ â†’ ê¸°ë³¸ê°’ì€ 'gray'
  TextColumn get colorId => text().withDefault(const Constant('gray'))();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë°˜ë³µ ì£¼ê¸°ë¥¼ JSON í˜•ì‹ì˜ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ìš”ì¼ë³„ ë°˜ë³µ ì„¤ì •ì„ ì €ìž¥í•œë‹¤
  // ì´ê±°ëŠ” ì´ëž˜ì„œ â†’ ì˜ˆ: '{"mon":true,"tue":false,...}'
  TextColumn get repeatRule => text()();

  // âœ… ë¦¬ë§ˆì¸ë” ì„¤ì • ì¶”ê°€ (JSON í˜•ì‹)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë¦¬ë§ˆì¸ë” ì„¤ì •ì„ JSON í˜•ì‹ì˜ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì•Œë¦¼ ì‹œê°„ì„ ì €ìž¥í•œë‹¤
  TextColumn get reminder => text().withDefault(const Constant(''))();
}

/// HabitCompletion (ìŠµê´€ ì™„ë£Œ ê¸°ë¡) í…Œì´ë¸”
/// ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë‚ ì§œë³„ ìŠµê´€ ì™„ë£Œ ê¸°ë¡ì„ ì €ìž¥í•˜ëŠ” í…Œì´ë¸”ì„ ì •ì˜í•´ì„œ
/// ì´ê±°ë¥¼ í•´ì„œ â†’ ì–´ë–¤ ë‚ ì§œì— ì–´ë–¤ ìŠµê´€ì„ ì™„ë£Œí–ˆëŠ”ì§€ ì¶”ì í•˜ê³ 
/// ì´ê±°ëŠ” ì´ëž˜ì„œ â†’ í†µê³„ì™€ ìŠ¤íŠ¸ë¦­(ì—°ì† ê¸°ë¡)ì„ ê³„ì‚°í•  ìˆ˜ ìžˆë‹¤
@DataClassName('HabitCompletionData')
class HabitCompletion extends Table {
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìžë™ ì¦ê°€í•˜ëŠ” idë¥¼ primary keyë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ê° ì™„ë£Œ ê¸°ë¡ì„ ê³ ìœ í•˜ê²Œ ì‹ë³„í•œë‹¤
  IntColumn get id => integer().autoIncrement()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ habitIdë¥¼ foreign keyë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ Habit í…Œì´ë¸”ê³¼ ì—°ê²°í•œë‹¤
  // ì´ê±°ëŠ” ì´ëž˜ì„œ â†’ ì–´ëŠ ìŠµê´€ì˜ ê¸°ë¡ì¸ì§€ ì•Œ ìˆ˜ ìžˆë‹¤
  IntColumn get habitId => integer()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì™„ë£Œí•œ ë‚ ì§œë¥¼ DateTimeìœ¼ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì–¸ì œ ì™„ë£Œí–ˆëŠ”ì§€ ê¸°ë¡í•œë‹¤
  DateTimeColumn get completedDate => dateTime()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ê¸°ë¡ ìƒì„±ì¼ì„ DateTimeìœ¼ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì–¸ì œ ì²´í¬í–ˆëŠ”ì§€ ê¸°ë¡í•œë‹¤
  DateTimeColumn get createdAt => dateTime()();
}

/// DailyCardOrder (ë‚ ì§œë³„ ì¹´ë“œ ìˆœì„œ ê´€ë¦¬) í…Œì´ë¸”
///
/// ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ íŠ¹ì • ë‚ ì§œì— í‘œì‹œë˜ëŠ” ëª¨ë“  ì¹´ë“œì˜ ìˆœì„œë¥¼ ê´€ë¦¬í•˜ëŠ” í…Œì´ë¸”ì„ ì •ì˜í•´ì„œ
/// ì´ê±°ë¥¼ í•´ì„œ â†’ ë‚ ì§œë§ˆë‹¤ ì‚¬ìš©ìžê°€ ì„¤ì •í•œ ì¹´ë“œ ë°°ì¹˜ ìˆœì„œë¥¼ ì €ìž¥í•˜ê³ 
/// ì´ê±°ëŠ” ì´ëž˜ì„œ â†’ ì¼ì •/í• ì¼/ìŠµê´€ì´ ì„žì¸ ìƒíƒœì—ì„œë„ ì •í™•í•œ ìˆœì„œë¥¼ ë³µì›í•  ìˆ˜ ìžˆë‹¤
///
/// **í•µì‹¬ ê°œë…:**
/// - ë‚ ì§œ(date)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê° ì¹´ë“œì˜ ìˆœì„œ(sortOrder)ë¥¼ ì €ìž¥
/// - cardType + cardIdë¡œ ì‹¤ì œ ì¹´ë“œ ë°ì´í„°ì™€ JOIN
/// - ê¸°ì¡´ Schedule/Task/Habit í…Œì´ë¸”ì€ ê±´ë“œë¦¬ì§€ ì•ŠìŒ
///
/// **ì‚¬ìš© ì˜ˆì‹œ:**
/// ```
/// 2025-10-18 ë‚ ì§œ:
///   - sortOrder: 0 â†’ schedule (id: 5)
///   - sortOrder: 1 â†’ task (id: 12)
///   - sortOrder: 2 â†’ schedule (id: 8)
///   - sortOrder: 3 â†’ habit (id: 3)
/// ```
@DataClassName('DailyCardOrderData')
class DailyCardOrder extends Table {
  // ðŸ”‘ Primary Key: ìžë™ ì¦ê°€ ID
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìžë™ ì¦ê°€í•˜ëŠ” idë¥¼ primary keyë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ê° ìˆœì„œ ë ˆì½”ë“œë¥¼ ê³ ìœ í•˜ê²Œ ì‹ë³„í•œë‹¤
  IntColumn get id => integer().autoIncrement()();

  // ðŸ“… ë‚ ì§œ (ê¸°ì¤€ ë‚ ì§œ - ì‹œê°„ ì œê±°ëœ 00:00:00)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì–´ëŠ ë‚ ì§œì˜ ìˆœì„œì¸ì§€ ì €ìž¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ë‚ ì§œë³„ë¡œ ë‹¤ë¥¸ ìˆœì„œë¥¼ ê´€ë¦¬í•œë‹¤
  // ì´ê±°ëŠ” ì´ëž˜ì„œ â†’ date_detail_viewì—ì„œ ë‚ ì§œë³„ë¡œ ì¿¼ë¦¬í•  ìˆ˜ ìžˆë‹¤
  DateTimeColumn get date => dateTime()();

  // ðŸŽ¯ ì¹´ë“œ íƒ€ìž… ('schedule' | 'task' | 'habit')
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì–´ë–¤ ì¢…ë¥˜ì˜ ì¹´ë“œì¸ì§€ êµ¬ë¶„í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ JOIN ì‹œ ì˜¬ë°”ë¥¸ í…Œì´ë¸”ì„ ì°¸ì¡°í•œë‹¤
  // ì´ê±°ëŠ” ì´ëž˜ì„œ â†’ 'schedule'ì´ë©´ Schedule í…Œì´ë¸”ê³¼ JOIN
  TextColumn get cardType => text()();

  // ðŸ†” ì‹¤ì œ ì¹´ë“œ ID (Schedule.id | Task.id | Habit.id)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì‹¤ì œ ë°ì´í„°ì˜ IDë¥¼ ì €ìž¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ Schedule/Task/Habit í…Œì´ë¸”ê³¼ JOIN ì—°ê²°í•œë‹¤
  // ì´ê±°ëŠ” ì´ëž˜ì„œ â†’ WHERE cardId = Schedule.id ì¡°ê±´ìœ¼ë¡œ ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜´
  IntColumn get cardId => integer()();

  // ðŸ“Š ì •ë ¬ ìˆœì„œ (0ë¶€í„° ì‹œìž‘, ìž‘ì„ìˆ˜ë¡ ìœ„)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ í™”ë©´ì— í‘œì‹œë  ìˆœì„œë¥¼ ìˆ«ìžë¡œ ì €ìž¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ORDER BY sortOrderë¡œ ì •ë ¬í•œë‹¤
  // ì´ê±°ëŠ” ì´ëž˜ì„œ â†’ ë“œëž˜ê·¸ì•¤ë“œë¡­ìœ¼ë¡œ ìˆœì„œê°€ ë°”ë€Œë©´ ì´ ê°’ë§Œ ì—…ë°ì´íŠ¸
  IntColumn get sortOrder => integer()();

  // â° ìˆ˜ì • ì‹œê°„ (ìˆœì„œê°€ ë³€ê²½ëœ ìµœì¢… ì‹œê°„)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì–¸ì œ ìˆœì„œê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ê¸°ë¡í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ë””ë²„ê¹… ë° ë™ê¸°í™” ì‹œ ì°¸ê³ í•œë‹¤
  // ì´ê±°ëŠ” ì´ëž˜ì„œ â†’ ê¸°ì¡´ ì¹´ë“œ í…Œì´ë¸”ì˜ createdAtì€ ê·¸ëŒ€ë¡œ ë‘ê³  ìˆ˜ì • ì‹œê°„ë§Œ ê´€ë¦¬
  DateTimeColumn get updatedAt =>
      dateTime().clientDefault(() => DateTime.now().toUtc())();
}
