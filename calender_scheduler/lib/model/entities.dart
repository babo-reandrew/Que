import 'package:drift/drift.dart';

/// Task (í• ì¼) í…Œì´ë¸”
/// ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ í• ì¼ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì„ ì •ì˜í•´ì„œ
/// ì´ê±°ë¥¼ í•´ì„œ â†’ ì œëª©, ì™„ë£Œ ì—¬ë¶€, ë§ˆê°ì¼, ìƒ‰ìƒ ë“±ì„ ê´€ë¦¬í•˜ê³ 
/// ì´ê±°ëŠ” ì´ë˜ì„œ â†’ Quick Add ì‹œìŠ¤í…œì—ì„œ í• ì¼ì„ ì¶”ê°€/ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤
@DataClassName('TaskData')
class Task extends Table {
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìë™ ì¦ê°€í•˜ëŠ” idë¥¼ primary keyë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ê° í• ì¼ì„ ê³ ìœ í•˜ê²Œ ì‹ë³„í•œë‹¤
  IntColumn get id => integer().autoIncrement()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì œëª©ì„ í•„ìˆ˜ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ í• ì¼ì˜ ë‚´ìš©ì„ ì €ì¥í•œë‹¤
  TextColumn get title => text()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì™„ë£Œ ì—¬ë¶€ë¥¼ booleanìœ¼ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì²´í¬ë°•ìŠ¤ ìƒíƒœë¥¼ ê´€ë¦¬í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ê¸°ë³¸ê°’ì€ false (ë¯¸ì™„ë£Œ)
  BoolColumn get completed => boolean().withDefault(const Constant(false))();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë§ˆê°ì¼ì„ nullable DateTimeìœ¼ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ë§ˆê°ì¼ì´ ì—†ëŠ” í• ì¼ë„ í—ˆìš©í•œë‹¤
  DateTimeColumn get dueDate => dateTime().nullable()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì‹¤í–‰ì¼ì„ nullable DateTimeìœ¼ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì‹¤í–‰ì¼ì´ ì§€ì •ëœ í• ì¼ì„ DetailViewì— í‘œì‹œí•˜ê³ 
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ì‹¤í–‰ì¼ì´ ì—†ìœ¼ë©´ Inboxì—ë§Œ í‘œì‹œëœë‹¤
  DateTimeColumn get executionDate => dateTime().nullable()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ëª©ë¡ IDë¥¼ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì—¬ëŸ¬ ëª©ë¡(Inbox, í”„ë¡œì íŠ¸ ë“±)ìœ¼ë¡œ ë¶„ë¥˜í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ê¸°ë³¸ê°’ì€ 'inbox'
  TextColumn get listId => text().withDefault(const Constant('inbox'))();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìƒì„±ì¼ì„ DateTimeìœ¼ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì–¸ì œ ë§Œë“¤ì–´ì¡ŒëŠ”ì§€ ê¸°ë¡í•œë‹¤
  DateTimeColumn get createdAt => dateTime()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì™„ë£Œì¼ì„ nullable DateTimeìœ¼ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì™„ë£Œëœ ë‚ ì§œë¥¼ ê¸°ë¡í•œë‹¤
  DateTimeColumn get completedAt => dateTime().nullable()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìƒ‰ìƒ IDë¥¼ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ìƒ‰ìƒì„ êµ¬ë¶„í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ê¸°ë³¸ê°’ì€ 'gray'
  TextColumn get colorId => text().withDefault(const Constant('gray'))();

  // âœ… ë°˜ë³µ ê·œì¹™ ì¶”ê°€ (JSON í˜•ì‹)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë°˜ë³µ ì£¼ê¸°ë¥¼ JSON í˜•ì‹ì˜ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ë§¤ì¼/ë§¤ì›”/ê°„ê²© ë°˜ë³µ ì„¤ì •ì„ ì €ì¥í•œë‹¤
  TextColumn get repeatRule => text().withDefault(const Constant(''))();

  // âœ… ë¦¬ë§ˆì¸ë” ì„¤ì • ì¶”ê°€ (JSON í˜•ì‹)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë¦¬ë§ˆì¸ë” ì„¤ì •ì„ JSON í˜•ì‹ì˜ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì•Œë¦¼ ì‹œê°„ì„ ì €ì¥í•œë‹¤
  TextColumn get reminder => text().withDefault(const Constant(''))();

  // âœ… ì¸ë°•ìŠ¤ ìˆœì„œ (ì¸ë°•ìŠ¤ ë°”í…€ì‹œíŠ¸ì—ì„œì˜ í‘œì‹œ ìˆœì„œ)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì¸ë°•ìŠ¤ ë‚´ì—ì„œì˜ ìˆœì„œë¥¼ ì •ìˆ˜ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì‚¬ìš©ìê°€ ì¸ë°•ìŠ¤ì—ì„œ ë“œë˜ê·¸ ì•¤ ë“œë¡­ìœ¼ë¡œ ìˆœì„œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ê¸°ë³¸ê°’ì€ 0
  IntColumn get inboxOrder => integer().withDefault(const Constant(0))();
}

/// Habit (ìŠµê´€) í…Œì´ë¸”
/// ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìŠµê´€ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì„ ì •ì˜í•´ì„œ
/// ì´ê±°ë¥¼ í•´ì„œ â†’ ë°˜ë³µë˜ëŠ” ë£¨í‹´ì„ ê´€ë¦¬í•˜ê³ 
/// ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ë‚ ì§œë³„ ì™„ë£Œ ê¸°ë¡ì„ ì¶”ì í•  ìˆ˜ ìˆë‹¤
@DataClassName('HabitData')
class Habit extends Table {
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìë™ ì¦ê°€í•˜ëŠ” idë¥¼ primary keyë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ê° ìŠµê´€ì„ ê³ ìœ í•˜ê²Œ ì‹ë³„í•œë‹¤
  IntColumn get id => integer().autoIncrement()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì œëª©ì„ í•„ìˆ˜ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ìŠµê´€ì˜ ë‚´ìš©ì„ ì €ì¥í•œë‹¤
  TextColumn get title => text()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìƒì„±ì¼ì„ DateTimeìœ¼ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì–¸ì œ ì‹œì‘í–ˆëŠ”ì§€ ê¸°ë¡í•œë‹¤
  DateTimeColumn get createdAt => dateTime()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìƒ‰ìƒ IDë¥¼ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ìƒ‰ìƒì„ êµ¬ë¶„í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ê¸°ë³¸ê°’ì€ 'gray'
  TextColumn get colorId => text().withDefault(const Constant('gray'))();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë°˜ë³µ ì£¼ê¸°ë¥¼ JSON í˜•ì‹ì˜ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ìš”ì¼ë³„ ë°˜ë³µ ì„¤ì •ì„ ì €ì¥í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ì˜ˆ: '{"mon":true,"tue":false,...}'
  TextColumn get repeatRule => text()();

  // âœ… ë¦¬ë§ˆì¸ë” ì„¤ì • ì¶”ê°€ (JSON í˜•ì‹)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë¦¬ë§ˆì¸ë” ì„¤ì •ì„ JSON í˜•ì‹ì˜ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì•Œë¦¼ ì‹œê°„ì„ ì €ì¥í•œë‹¤
  TextColumn get reminder => text().withDefault(const Constant(''))();
}

/// HabitCompletion (ìŠµê´€ ì™„ë£Œ ê¸°ë¡) í…Œì´ë¸”
/// ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë‚ ì§œë³„ ìŠµê´€ ì™„ë£Œ ê¸°ë¡ì„ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì„ ì •ì˜í•´ì„œ
/// ì´ê±°ë¥¼ í•´ì„œ â†’ ì–´ë–¤ ë‚ ì§œì— ì–´ë–¤ ìŠµê´€ì„ ì™„ë£Œí–ˆëŠ”ì§€ ì¶”ì í•˜ê³ 
/// ì´ê±°ëŠ” ì´ë˜ì„œ â†’ í†µê³„ì™€ ìŠ¤íŠ¸ë¦­(ì—°ì† ê¸°ë¡)ì„ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤
@DataClassName('HabitCompletionData')
class HabitCompletion extends Table {
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìë™ ì¦ê°€í•˜ëŠ” idë¥¼ primary keyë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ê° ì™„ë£Œ ê¸°ë¡ì„ ê³ ìœ í•˜ê²Œ ì‹ë³„í•œë‹¤
  IntColumn get id => integer().autoIncrement()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ habitIdë¥¼ foreign keyë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ Habit í…Œì´ë¸”ê³¼ ì—°ê²°í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ì–´ëŠ ìŠµê´€ì˜ ê¸°ë¡ì¸ì§€ ì•Œ ìˆ˜ ìˆë‹¤
  IntColumn get habitId => integer()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì™„ë£Œí•œ ë‚ ì§œë¥¼ DateTimeìœ¼ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì–¸ì œ ì™„ë£Œí–ˆëŠ”ì§€ ê¸°ë¡í•œë‹¤
  DateTimeColumn get completedDate => dateTime()();

  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ê¸°ë¡ ìƒì„±ì¼ì„ DateTimeìœ¼ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì–¸ì œ ì²´í¬í–ˆëŠ”ì§€ ê¸°ë¡í•œë‹¤
  DateTimeColumn get createdAt => dateTime()();
}

/// DailyCardOrder (ë‚ ì§œë³„ ì¹´ë“œ ìˆœì„œ ê´€ë¦¬) í…Œì´ë¸”
///
/// ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ íŠ¹ì • ë‚ ì§œì— í‘œì‹œë˜ëŠ” ëª¨ë“  ì¹´ë“œì˜ ìˆœì„œë¥¼ ê´€ë¦¬í•˜ëŠ” í…Œì´ë¸”ì„ ì •ì˜í•´ì„œ
/// ì´ê±°ë¥¼ í•´ì„œ â†’ ë‚ ì§œë§ˆë‹¤ ì‚¬ìš©ìê°€ ì„¤ì •í•œ ì¹´ë“œ ë°°ì¹˜ ìˆœì„œë¥¼ ì €ì¥í•˜ê³ 
/// ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ì¼ì •/í• ì¼/ìŠµê´€ì´ ì„ì¸ ìƒíƒœì—ì„œë„ ì •í™•í•œ ìˆœì„œë¥¼ ë³µì›í•  ìˆ˜ ìˆë‹¤
///
/// **í•µì‹¬ ê°œë…:**
/// - ë‚ ì§œ(date)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê° ì¹´ë“œì˜ ìˆœì„œ(sortOrder)ë¥¼ ì €ì¥
/// - cardType + cardIdë¡œ ì‹¤ì œ ì¹´ë“œ ë°ì´í„°ì™€ JOIN
/// - ê¸°ì¡´ Schedule/Task/Habit í…Œì´ë¸”ì€ ê±´ë“œë¦¬ì§€ ì•ŠìŒ
///
/// **ì‚¬ìš© ì˜ˆì‹œ:**
/// ```
/// 2025-10-18 ë‚ ì§œ:
///   - sortOrder: 0 â†’ schedule (id: 5)
///   - sortOrder: 1 â†’ task (id: 12)
///   - sortOrder: 2 â†’ schedule (id: 8)
///   - sortOrder: 3 â†’ habit (id: 3)
/// ```
@DataClassName('DailyCardOrderData')
class DailyCardOrder extends Table {
  // ğŸ”‘ Primary Key: ìë™ ì¦ê°€ ID
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìë™ ì¦ê°€í•˜ëŠ” idë¥¼ primary keyë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ê° ìˆœì„œ ë ˆì½”ë“œë¥¼ ê³ ìœ í•˜ê²Œ ì‹ë³„í•œë‹¤
  IntColumn get id => integer().autoIncrement()();

  // ğŸ“… ë‚ ì§œ (ê¸°ì¤€ ë‚ ì§œ - ì‹œê°„ ì œê±°ëœ 00:00:00)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì–´ëŠ ë‚ ì§œì˜ ìˆœì„œì¸ì§€ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ë‚ ì§œë³„ë¡œ ë‹¤ë¥¸ ìˆœì„œë¥¼ ê´€ë¦¬í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ date_detail_viewì—ì„œ ë‚ ì§œë³„ë¡œ ì¿¼ë¦¬í•  ìˆ˜ ìˆë‹¤
  DateTimeColumn get date => dateTime()();

  // ğŸ¯ ì¹´ë“œ íƒ€ì… ('schedule' | 'task' | 'habit')
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì–´ë–¤ ì¢…ë¥˜ì˜ ì¹´ë“œì¸ì§€ êµ¬ë¶„í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ JOIN ì‹œ ì˜¬ë°”ë¥¸ í…Œì´ë¸”ì„ ì°¸ì¡°í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ 'schedule'ì´ë©´ Schedule í…Œì´ë¸”ê³¼ JOIN
  TextColumn get cardType => text()();

  // ğŸ†” ì‹¤ì œ ì¹´ë“œ ID (Schedule.id | Task.id | Habit.id)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì‹¤ì œ ë°ì´í„°ì˜ IDë¥¼ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ Schedule/Task/Habit í…Œì´ë¸”ê³¼ JOIN ì—°ê²°í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ WHERE cardId = Schedule.id ì¡°ê±´ìœ¼ë¡œ ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜´
  IntColumn get cardId => integer()();

  // ğŸ“Š ì •ë ¬ ìˆœì„œ (0ë¶€í„° ì‹œì‘, ì‘ì„ìˆ˜ë¡ ìœ„)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ í™”ë©´ì— í‘œì‹œë  ìˆœì„œë¥¼ ìˆ«ìë¡œ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ORDER BY sortOrderë¡œ ì •ë ¬í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ë“œë˜ê·¸ì•¤ë“œë¡­ìœ¼ë¡œ ìˆœì„œê°€ ë°”ë€Œë©´ ì´ ê°’ë§Œ ì—…ë°ì´íŠ¸
  IntColumn get sortOrder => integer()();

  // â° ìˆ˜ì • ì‹œê°„ (ìˆœì„œê°€ ë³€ê²½ëœ ìµœì¢… ì‹œê°„)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì–¸ì œ ìˆœì„œê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ê¸°ë¡í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ë””ë²„ê¹… ë° ë™ê¸°í™” ì‹œ ì°¸ê³ í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ê¸°ì¡´ ì¹´ë“œ í…Œì´ë¸”ì˜ createdAtì€ ê·¸ëŒ€ë¡œ ë‘ê³  ìˆ˜ì • ì‹œê°„ë§Œ ê´€ë¦¬
  DateTimeColumn get updatedAt =>
      dateTime().clientDefault(() => DateTime.now().toUtc())();
}

// ============================================================================
// ğŸµ Insight Player ê´€ë ¨ í…Œì´ë¸” (Phase 1)
// ============================================================================

/// AudioContents (ì¸ì‚¬ì´íŠ¸ ì˜¤ë””ì˜¤ - ë©”íƒ€ë°ì´í„° + ì¬ìƒ ìƒíƒœ í†µí•©)
/// ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì˜¤ë””ì˜¤ ì •ë³´ì™€ ì¬ìƒ ìƒíƒœë¥¼ í•˜ë‚˜ì˜ í…Œì´ë¸”ì—ì„œ ê´€ë¦¬í•´ì„œ
/// ì´ê±°ë¥¼ í•´ì„œ â†’ JOIN ì—†ì´ í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ ëª¨ë“  ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤
/// ì´ê±°ëŠ” ì´ë˜ì„œ â†’ amlv LyricViewer ì¬ìƒ ì¤‘ ëª¨ë“  ìƒíƒœë¥¼ ì™„ë²½í•˜ê²Œ ì¶”ì í•  ìˆ˜ ìˆë‹¤
///
/// **ì¬ìƒ ì‹œë‚˜ë¦¬ì˜¤ë³„ ë°ì´í„° íë¦„:**
/// 1. ì²« ì¬ìƒ: playCount++, lastPlayedAt=now, lastPositionMs=0
/// 2. ì¬ìƒ ì¤‘: onLyricChanged â†’ lastPositionMs ì—…ë°ì´íŠ¸
/// 3. ì¼ì‹œì •ì§€/ì¢…ë£Œ: ë§ˆì§€ë§‰ ìœ„ì¹˜ ìë™ ì €ì¥ â†’ ì´ì–´ë“£ê¸° ê°€ëŠ¥
/// 4. ì™„ë£Œ(90%+): isCompleted=true, completedAt=now
/// 5. ì¬ì‹œì‘: lastPositionMs=0, playCount++
@DataClassName('AudioContentData')
class AudioContents extends Table {
  // ========== ï¿½ ë©”íƒ€ë°ì´í„° (ë¶ˆë³€ ì •ë³´) ==========

  // ï¿½ğŸ”‘ ê³ ìœ  ID
  IntColumn get id => integer().autoIncrement()();

  // ğŸ“ ì œëª© (ì˜ˆ: "éå»ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è¦‹ãˆã‚‹è‡ªåˆ†å¯èƒ½æ€§")
  TextColumn get title => text()();

  // ğŸ“ ë¶€ì œëª© (ì˜ˆ: "ã‚¤ãƒ³ã‚µã‚¤ãƒˆ")
  TextColumn get subtitle => text()();

  // ğŸµ ì˜¤ë””ì˜¤ íŒŒì¼ ê²½ë¡œ (audio/insight_001.mp3)
  // âš ï¸ ì£¼ì˜: amlvì˜ AssetSourceê°€ "assets/" ìë™ ì¶”ê°€í•˜ë¯€ë¡œ
  //    "audio/..."ë¡œ ì €ì¥ (O), "asset/audio/..."ë¡œ ì €ì¥ (X)
  TextColumn get audioPath => text()();

  // â±ï¸ ì´ ì¬ìƒ ì‹œê°„ (ì´ˆ ë‹¨ìœ„)
  IntColumn get durationSeconds => integer()();

  // ğŸ“… ëŒ€ìƒ ë‚ ì§œ (ì •ê·œí™”: YYYY-MM-DD 00:00:00)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë‚ ì§œë¥¼ ì •ê·œí™”í•´ì„œ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ WHERE targetDate = DATE('2025-10-18') ë¡œ ì¡°íšŒí•œë‹¤
  DateTimeColumn get targetDate => dateTime()();

  // â° ìƒì„± ì‹œê°„
  DateTimeColumn get createdAt => dateTime().withDefault(currentDateAndTime)();

  // ========== ğŸ¬ ì¬ìƒ ìƒíƒœ (ê°€ë³€ ì •ë³´) ==========

  // ğŸ¯ ë§ˆì§€ë§‰ ì¬ìƒ ìœ„ì¹˜ (ë°€ë¦¬ì´ˆ)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ amlv onLyricChangedì—ì„œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì•± ì¬ì‹œì‘ ì‹œ ì´ì–´ë“£ê¸°ë¥¼ ì§€ì›í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ì™„ë£Œ í›„ ì¬ì‹œì‘í•˜ë©´ 0ìœ¼ë¡œ ë¦¬ì…‹ëœë‹¤
  IntColumn get lastPositionMs => integer().withDefault(const Constant(0))();

  // âœ… ì™„ë£Œ ì—¬ë¶€ (90% ì´ìƒ ì¬ìƒ ì‹œ true)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ amlv onCompleted ì½œë°±ì—ì„œ trueë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì™„ë£Œëœ ì¸ì‚¬ì´íŠ¸ë¥¼ êµ¬ë¶„í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ì¬ì‹œì‘í•´ë„ ìœ ì§€ë¨ (í†µê³„ìš©)
  BoolColumn get isCompleted => boolean().withDefault(const Constant(false))();

  // â° ë§ˆì§€ë§‰ ì¬ìƒ ì‹œê° (null = í•œ ë²ˆë„ ì•ˆ ë“¤ìŒ)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì¬ìƒ ì‹œì‘í•  ë•Œë§ˆë‹¤ DateTime.now()ë¡œ ì—…ë°ì´íŠ¸í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ "ìµœê·¼ ë“¤ì€ ì¸ì‚¬ì´íŠ¸" ëª©ë¡ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ nullableì´ë¯€ë¡œ ë¯¸ì¬ìƒ ìƒíƒœë„ í‘œí˜„ ê°€ëŠ¥
  DateTimeColumn get lastPlayedAt => dateTime().nullable()();

  // ğŸ‰ ì™„ë£Œ ì‹œê° (null = ë¯¸ì™„ë£Œ)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ isCompleted=true ë  ë•Œ DateTime.now()ë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì–¸ì œ ì™„ë£Œí–ˆëŠ”ì§€ ê¸°ë¡í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ì™„ë£Œ í›„ ì¬ì‹œì‘í•´ë„ ê¸°ë¡ì€ ìœ ì§€ë¨
  DateTimeColumn get completedAt => dateTime().nullable()();

  // ğŸ“Š ì´ ì¬ìƒ íšŸìˆ˜ (í†µê³„ìš©)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì¬ìƒ ì‹œì‘í•  ë•Œë§ˆë‹¤ +1 ì¦ê°€ì‹œì¼œì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ëª‡ ë²ˆ ë“¤ì—ˆëŠ”ì§€ ì¶”ì í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ì¸ê¸° ì¸ì‚¬ì´íŠ¸ ë¶„ì„ì— ì‚¬ìš© ê°€ëŠ¥
  IntColumn get playCount => integer().withDefault(const Constant(0))();

  // ï¿½ ì„±ëŠ¥ ìµœì í™”: targetDate UNIQUE ì œì•½
  // â†’ í•˜ë£¨ì— í•˜ë‚˜ì˜ ì¸ì‚¬ì´íŠ¸ë§Œ (ì¤‘ë³µ ë°©ì§€)
  // â†’ WHERE targetDate = '2025-10-18' ì¿¼ë¦¬ ìµœì í™” (ì¸ë±ìŠ¤ ìŠ¤ìº”)
  @override
  List<Set<Column>> get uniqueKeys => [
    {targetDate}, // í•˜ë‚˜ì˜ ë‚ ì§œì—ëŠ” í•˜ë‚˜ì˜ ì¸ì‚¬ì´íŠ¸ë§Œ
  ];
}

/// TranscriptLines (ìŠ¤í¬ë¦½íŠ¸ ë¼ì¸ - amlv LyricViewer í˜¸í™˜)
/// ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ LRC íŒŒì‹± ê²°ê³¼ë¥¼ íƒ€ì„ìŠ¤íƒ¬í”„ì™€ í•¨ê»˜ ì €ì¥í•´ì„œ
/// ì´ê±°ë¥¼ í•´ì„œ â†’ amlvê°€ ì˜¤ë””ì˜¤ ì¬ìƒ ì¤‘ ìë™ìœ¼ë¡œ ìŠ¤í¬ë¡¤í•˜ë©° í‘œì‹œí•œë‹¤
/// ì´ê±°ëŠ” ì´ë˜ì„œ â†’ startTimeMs ê¸°ë°˜ìœ¼ë¡œ í˜„ì¬ ë¼ì¸ì„ O(log n)ì— ì°¾ì„ ìˆ˜ ìˆë‹¤
///
/// **amlv í†µí•© ë°©ì‹:**
/// ```dart
/// final lyricLines = transcriptLines.map((line) => LyricLine(
///   time: Duration(milliseconds: line.startTimeMs),
///   content: line.content,
/// )).toList();
/// ```
@DataClassName('TranscriptLineData')
class TranscriptLines extends Table {
  // ğŸ”‘ ê³ ìœ  ID
  IntColumn get id => integer().autoIncrement()();

  // ğŸ”— ì˜¤ë””ì˜¤ ì½˜í…ì¸  ì°¸ì¡° (CASCADE DELETE)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ AudioContentsê°€ ì‚­ì œë˜ë©´ ìë™ ì‚­ì œë˜ë„ë¡ í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ê³ ì•„ ë ˆì½”ë“œ(orphan record)ë¥¼ ë°©ì§€í•œë‹¤
  IntColumn get audioContentId =>
      integer().references(AudioContents, #id, onDelete: KeyAction.cascade)();

  // ğŸ“Š ìˆœì„œ ë²ˆí˜¸ (0ë¶€í„° ì‹œì‘)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ìŠ¤í¬ë¦½íŠ¸ì˜ ìˆœì„œë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ORDER BY sequenceë¡œ ì •ë ¬í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ "3ë²ˆì§¸ ë¼ì¸" ê°™ì€ ìœ„ì¹˜ ê¸°ë°˜ ì¿¼ë¦¬ ê°€ëŠ¥
  IntColumn get sequence => integer()();

  // â±ï¸ ì‹œì‘ ì‹œê°„ (ë°€ë¦¬ì´ˆ)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì´ ë¼ì¸ì´ í‘œì‹œë  íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ amlvê°€ ì˜¤ë””ì˜¤ ìœ„ì¹˜ì™€ ë¹„êµí•˜ì—¬ í˜„ì¬ ë¼ì¸ì„ ê²°ì •í•œë‹¤
  IntColumn get startTimeMs => integer()();

  // â±ï¸ ì¢…ë£Œ ì‹œê°„ (ë°€ë¦¬ì´ˆ)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë‹¤ìŒ ë¼ì¸ìœ¼ë¡œ ë„˜ì–´ê°ˆ íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ë¼ì¸ ì§€ì† ì‹œê°„ì„ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ duration = endTimeMs - startTimeMs
  IntColumn get endTimeMs => integer()();

  // ğŸ“ ìŠ¤í¬ë¦½íŠ¸ í…ìŠ¤íŠ¸ ë‚´ìš©
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì‹¤ì œ í‘œì‹œë  í…ìŠ¤íŠ¸ë¥¼ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ amlv LyricViewerì— ë Œë”ë§í•œë‹¤
  TextColumn get content => text()();

  // ğŸ” ì„±ëŠ¥ ìµœì í™”: {audioContentId, sequence} ë³µí•© UNIQUE ì œì•½
  // â†’ ê°™ì€ ì˜¤ë””ì˜¤ì—ì„œ ìˆœì„œ ì¤‘ë³µ ë°©ì§€ (ë°ì´í„° ë¬´ê²°ì„±)
  // â†’ WHERE audioContentId=X AND sequence=Y ì¿¼ë¦¬ ìµœì í™” (ë³µí•© ì¸ë±ìŠ¤)
  @override
  List<Set<Column>> get uniqueKeys => [
    {audioContentId, sequence}, // ê°™ì€ ì˜¤ë””ì˜¤ì—ì„œ ìˆœì„œëŠ” ì¤‘ë³µ ë¶ˆê°€
  ];
}

// ============================================================================
// ğŸ” ë°˜ë³µ ì´ë²¤íŠ¸ ê´€ë¦¬ í…Œì´ë¸” (RFC 5545 RRULE í‘œì¤€)
// ============================================================================

/// RecurringPattern (ë°˜ë³µ ê·œì¹™ - RFC 5545 RRULE ê¸°ë°˜)
/// ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì¼ì •/í• ì¼/ìŠµê´€ì˜ ë°˜ë³µ íŒ¨í„´ì„ RRULE í‘œì¤€ìœ¼ë¡œ ì €ì¥í•´ì„œ
/// ì´ê±°ë¥¼ í•´ì„œ â†’ êµ¬ê¸€ ìº˜ë¦°ë”ì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ë°˜ë³µì„ ì²˜ë¦¬í•˜ê³ 
/// ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ëŸ°íƒ€ì„ì— ë™ì ìœ¼ë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„ ë†’ì¸ë‹¤
///
/// **Expert Way: 1ê°œ ê·œì¹™ + ì˜ˆì™¸ ì €ì¥ ë°©ì‹**
/// - Base Event 1ê°œ + RRULE 1ê°œ â†’ ë¬´í•œ ë°˜ë³µë„ O(1) ì €ì¥ ê³µê°„
/// - ìˆ˜ì •ëœ ì¸ìŠ¤í„´ìŠ¤ë§Œ RecurringExceptionì— ì €ì¥
/// - ë§¤ë²ˆ ê°œë³„ í–‰ ìƒì„± âŒ â†’ ê³µê°„ íš¨ìœ¨ 100ë°°â†‘
///
/// **RRULE ì˜ˆì‹œ:**
/// ```
/// FREQ=WEEKLY;INTERVAL=2;BYDAY=MO,FR;UNTIL=20250601T235959Z
/// â†’ ë§¤ì£¼ ì›”/ê¸ˆìš”ì¼, 2025-06-01ê¹Œì§€
/// ```
@DataClassName('RecurringPatternData')
class RecurringPattern extends Table {
  // ğŸ”‘ Primary Key: ìë™ ì¦ê°€ ID
  IntColumn get id => integer().autoIncrement()();

  // ğŸ¯ ì—°ê²°ëœ ì´ë²¤íŠ¸ íƒ€ì… ('schedule' | 'task' | 'habit')
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì–´ëŠ í…Œì´ë¸”ì˜ ë°˜ë³µì¸ì§€ êµ¬ë¶„í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ Schedule/Task/Habit í…Œì´ë¸”ê³¼ JOIN ì—°ê²°í•œë‹¤
  TextColumn get entityType => text()();

  // ğŸ†” ì—°ê²°ëœ ì´ë²¤íŠ¸ ID (Schedule.id | Task.id | Habit.id)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì‹¤ì œ Base Eventì˜ IDë¥¼ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ WHERE entityId = ? ì¡°ê±´ìœ¼ë¡œ ë°˜ë³µ ê·œì¹™ì„ ì¡°íšŒí•œë‹¤
  IntColumn get entityId => integer()();

  // ğŸ“‹ RRULE ë¬¸ìì—´ (RFC 5545 í‘œì¤€)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ í‘œì¤€ RRULE í¬ë§·ìœ¼ë¡œ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬(rrule.dart)ë¡œ íŒŒì‹±í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ êµ¬ê¸€ ìº˜ë¦°ë”ì™€ ì™„ë²½í•˜ê²Œ í˜¸í™˜ ê°€ëŠ¥
  //
  // ì˜ˆì‹œ:
  // - ë§¤ì¼: "FREQ=DAILY"
  // - ë§¤ì£¼ ì›”/ìˆ˜/ê¸ˆ: "FREQ=WEEKLY;BYDAY=MO,WE,FR"
  // - ë§¤ì›” ë§ˆì§€ë§‰ ë‚ : "FREQ=MONTHLY;BYMONTHDAY=-1"
  // - ë§¤ë…„ 2ì›” 29ì¼: "FREQ=YEARLY;BYMONTH=2;BYMONTHDAY=29"
  TextColumn get rrule => text()();

  // ğŸ—“ï¸ ë°˜ë³µ ì‹œì‘ì¼ (Base Eventì˜ ì‹œì‘ì¼ê³¼ ë™ì¼)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì²« ë°œìƒ ë‚ ì§œë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ RRULE ìƒì„± ì‹œ DTSTARTë¡œ ì‚¬ìš©í•œë‹¤
  DateTimeColumn get dtstart => dateTime()();

  // ğŸ—“ï¸ ë°˜ë³µ ì¢…ë£Œì¼ (nullable - ë¬´í•œ ë°˜ë³µ ê°€ëŠ¥)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë§ˆì§€ë§‰ ë°œìƒ ë‚ ì§œë¥¼ nullableë¡œ ì„¤ì •í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ nullì´ë©´ ë¬´í•œ ë°˜ë³µ, ë‚ ì§œ ìˆìœ¼ë©´ ê·¸ë‚ ê¹Œì§€ ë°˜ë³µ
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ RRULEì˜ UNTILê³¼ ë§¤ì¹­ë¨
  DateTimeColumn get until => dateTime().nullable()();

  // ğŸ”¢ ìµœëŒ€ ë°œìƒ íšŸìˆ˜ (nullable)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ RRULEì˜ COUNT íŒŒë¼ë¯¸í„°ë¥¼ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ "10íšŒ ë°˜ë³µ" ê°™ì€ ì„¤ì •ì„ ì§€ì›í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ untilê³¼ í•¨ê»˜ ì‚¬ìš© ë¶ˆê°€ (ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ)
  IntColumn get count => integer().nullable()();

  // ğŸŒ ì‹œê°„ëŒ€ ì •ë³´ (IANA Timezone ID)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ "Asia/Seoul" ê°™ì€ ì‹œê°„ëŒ€ë¥¼ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì¼ê´‘ì ˆì•½ì‹œê°„(DST) ì²˜ë¦¬ë¥¼ ì •í™•í•˜ê²Œ í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ ê¸°ë³¸ê°’ì€ 'UTC'
  TextColumn get timezone => text().withDefault(const Constant('UTC'))();

  // ğŸš« EXDATE (ì œì™¸í•  ë‚ ì§œë“¤ - ì‰¼í‘œ êµ¬ë¶„)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ íŠ¹ì • ë‚ ì§œë¥¼ ì œì™¸í•˜ëŠ” EXDATEë¥¼ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ì‚­ì œ ì‹œ RRULEì€ ìœ ì§€í•˜ê³  EXDATEë§Œ ì¶”ê°€
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ "20250315T100000,20250322T100000" í˜•ì‹
  TextColumn get exdate => text().withDefault(const Constant(''))();

  // â° ìƒì„± ì‹œê°„
  DateTimeColumn get createdAt => dateTime().withDefault(currentDateAndTime)();

  // â° ìˆ˜ì • ì‹œê°„
  DateTimeColumn get updatedAt => dateTime().withDefault(currentDateAndTime)();

  // ğŸ” ì„±ëŠ¥ ìµœì í™”: {entityType, entityId} ë³µí•© UNIQUE ì œì•½
  // â†’ í•˜ë‚˜ì˜ ì´ë²¤íŠ¸ì—ëŠ” í•˜ë‚˜ì˜ ë°˜ë³µ ê·œì¹™ë§Œ (ë°ì´í„° ë¬´ê²°ì„±)
  // â†’ WHERE entityType='schedule' AND entityId=5 ì¿¼ë¦¬ ìµœì í™”
  @override
  List<Set<Column>> get uniqueKeys => [
    {entityType, entityId}, // í•˜ë‚˜ì˜ ì´ë²¤íŠ¸ì—ëŠ” í•˜ë‚˜ì˜ ë°˜ë³µ ê·œì¹™
  ];
}

/// RecurringException (ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì˜ˆì™¸ - ìˆ˜ì •/ì‚­ì œëœ ë°œìƒ)
/// ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ë°˜ë³µ ì¼ì • ì¤‘ ìˆ˜ì •ë˜ê±°ë‚˜ ì‚­ì œëœ íŠ¹ì • ë°œìƒì„ ì €ì¥í•´ì„œ
/// ì´ê±°ë¥¼ í•´ì„œ â†’ ì›ë³¸ RRULEì€ ìœ ì§€í•˜ë©´ì„œ ì˜ˆì™¸ë§Œ ì²˜ë¦¬í•˜ê³ 
/// ì´ê±°ëŠ” ì´ë˜ì„œ â†’ "ì´í›„ ëª¨ë“  ì¼ì • ìˆ˜ì •" ì—†ì´ ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ë§Œ ë³€ê²½ ê°€ëŠ¥
///
/// **ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
/// 1. ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ì‚­ì œ:
///    - isCancelled=true, originalDate='2025-03-15T10:00:00'
///    - RRULEì€ ìœ ì§€, í•´ë‹¹ ë‚ ì§œë§Œ ìŠ¤í‚µ
///
/// 2. ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ì‹œê°„ ë³€ê²½:
///    - isRescheduled=true
///    - originalDate='2025-03-15T10:00:00'
///    - newStartDate='2025-03-15T14:00:00'
///
/// 3. ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ë‚´ìš© ë³€ê²½:
///    - modifiedTitle='ê¸´ê¸‰ íšŒì˜ (ë³€ê²½ë¨)'
///    - ë‹¤ë¥¸ í•„ë“œëŠ” Base Event ìƒì†
@DataClassName('RecurringExceptionData')
class RecurringException extends Table {
  // ğŸ”‘ Primary Key: ìë™ ì¦ê°€ ID
  IntColumn get id => integer().autoIncrement()();

  // ğŸ”— ë°˜ë³µ ê·œì¹™ ì°¸ì¡° (CASCADE DELETE)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ RecurringPatternì´ ì‚­ì œë˜ë©´ ìë™ ì‚­ì œë˜ë„ë¡ í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ê³ ì•„ ë ˆì½”ë“œ(orphan record)ë¥¼ ë°©ì§€í•œë‹¤
  IntColumn get recurringPatternId => integer().references(
    RecurringPattern,
    #id,
    onDelete: KeyAction.cascade,
  )();

  // ğŸ—“ï¸ ì›ë˜ ë°œìƒ ë‚ ì§œ/ì‹œê°„ (ë³€ê²½ ì „)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì–´ëŠ ì¸ìŠ¤í„´ìŠ¤ê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ì‹ë³„í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ RRULE ìƒì„± ê²°ê³¼ì™€ ë¹„êµí•˜ì—¬ ì˜ˆì™¸ ì²˜ë¦¬í•œë‹¤
  // ì´ê±°ëŠ” ì´ë˜ì„œ â†’ "2025-03-15 10:00 íšŒì˜" â†’ ì˜ˆì™¸ ì ìš©
  DateTimeColumn get originalDate => dateTime()();

  // âŒ ì·¨ì†Œ ì—¬ë¶€ (ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ì‚­ì œ)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ trueë©´ í•´ë‹¹ ë‚ ì§œ ë°œìƒì„ ìŠ¤í‚µí•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ìº˜ë¦°ë”ì— í‘œì‹œí•˜ì§€ ì•ŠëŠ”ë‹¤
  BoolColumn get isCancelled => boolean().withDefault(const Constant(false))();

  // ğŸ“… ì¬ì¡°ì • ì—¬ë¶€ (ì‹œê°„ ë³€ê²½)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ trueë©´ ìƒˆ ì‹œê°„ìœ¼ë¡œ í‘œì‹œí•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ ì›ë˜ ì‹œê°„ ëŒ€ì‹  newStartDate/newEndDate ì‚¬ìš©
  BoolColumn get isRescheduled =>
      boolean().withDefault(const Constant(false))();

  // ğŸ• ìƒˆë¡œìš´ ì‹œì‘ ì‹œê°„ (nullable)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì¬ì¡°ì •ëœ ì‹œì‘ ì‹œê°„ì„ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ isRescheduled=trueì¼ ë•Œ ì‚¬ìš©í•œë‹¤
  DateTimeColumn get newStartDate => dateTime().nullable()();

  // ğŸ• ìƒˆë¡œìš´ ì¢…ë£Œ ì‹œê°„ (nullable)
  // ì´ê±°ë¥¼ ì„¤ì •í•˜ê³  â†’ ì¬ì¡°ì •ëœ ì¢…ë£Œ ì‹œê°„ì„ ì €ì¥í•´ì„œ
  // ì´ê±°ë¥¼ í•´ì„œ â†’ isRescheduled=trueì¼ ë•Œ ì‚¬ìš©í•œë‹¤
  DateTimeColumn get newEndDate => dateTime().nullable()();

  // ========== ìˆ˜ì •ëœ í•„ë“œë“¤ (nullable - ë³€ê²½ ì‹œë§Œ ì €ì¥) ==========

  // ğŸ“ ìˆ˜ì •ëœ ì œëª© (nullable)
  TextColumn get modifiedTitle => text().nullable()();

  // ğŸ“ ìˆ˜ì •ëœ ì„¤ëª… (nullable)
  TextColumn get modifiedDescription => text().nullable()();

  // ğŸ“ ìˆ˜ì •ëœ ì¥ì†Œ (nullable)
  TextColumn get modifiedLocation => text().nullable()();

  // ğŸ¨ ìˆ˜ì •ëœ ìƒ‰ìƒ ID (nullable)
  TextColumn get modifiedColorId => text().nullable()();

  // â° ìƒì„± ì‹œê°„
  DateTimeColumn get createdAt => dateTime().withDefault(currentDateAndTime)();

  // â° ìˆ˜ì • ì‹œê°„
  DateTimeColumn get updatedAt => dateTime().withDefault(currentDateAndTime)();

  // ğŸ” ì„±ëŠ¥ ìµœì í™”: {recurringPatternId, originalDate} ë³µí•© UNIQUE ì œì•½
  // â†’ ê°™ì€ ë°˜ë³µ ê·œì¹™ì—ì„œ ê°™ì€ ë‚ ì§œëŠ” í•œ ë²ˆë§Œ ì˜ˆì™¸ ì²˜ë¦¬ ê°€ëŠ¥
  @override
  List<Set<Column>> get uniqueKeys => [
    {recurringPatternId, originalDate},
  ];
}
